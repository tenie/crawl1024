<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/img/timg.jpg">

    <title>爬图小虫</title>
<!--/crawl/src/main/resources/static/assets/img/timg.jpg  -->
    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/main.css" rel="stylesheet">
    
    <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,700' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.js"></script>
      <script src="assets/js/respond.min.js"></script>
    <![endif]-->
    <style>
    	p{
    		 margin-bottom: 10px;
    	}
    </style>
  </head>

  <!-- 
<body style="padding-top: 60px;" onbeforeunload="	return '?'"> -->
<body style="padding-top: 60px;"  >


    <div class="container" >
    	<div class="col-lg-12">
    	
    		<!-- ===== vCard Navigation ===== -->
    		<div class="row w" style="    height: 500px;">
    			<div class="col-md-4">
    				<!-- <img class="img-responsive" src="assets/img/head.png" alt=""> -->
					<ul class="nav nav-tabs nav-stacked" id="myTab">
					  <li class="active"><a href="#about">单页面</a></li>
					  <li><a href="#portfolio">多页面批处理</a></li>
					  <li><a href="#profile">代理配置</a></li>
					  <li><a href="#contact">图片下载</a></li>
					<!--   <li><a  id="foobtn">foobtn</a></li> -->
					</ul>    			
				</div><!-- col-md-4 -->

    		<!-- ===== vCard Content ===== -->
    			<div class="col-md-8">
	    			<div class="tab-content">
	    			
	    			  <!-- ===== First Tab ===== -->
					  <div class="tab-pane active" id="about">
					  <form id="form1">
					 
 
					  	<h3>获取单个页面中的图片</h3> 
					  	<hr>
					  	  <div style="margin-bottom: 10px;"> 
					  	 
					  		<p style="margin-bottom: 5px;">
					  			单个页面url:<input name="url1" style="width: 506px;" >
					  		</p>  
					  		<span> 
					  			元素选择器表达式:<input name="select"  >
					  	    </span>  
					  		<span>
					  			元素属性:<input name="attr">
					  		</span>  
					  		<button id="btn1">提交</button> 
					     </div>
					  	<textarea id="viewURL" rows="12" cols="80" readonly > </textarea>
			
					  </form>
					  </div><!-- tab about -->
					  
	    			  <!-- ===== Second Tab ===== -->
					  <div class="tab-pane" id="profile">
					  	<h4><i class="icon-briefcase"></i> 代理设置,翻墙用的代理服务器</h4>
					  	<p class="sm">
					  		<grey>代理服务器地址:<input name="host" id="host"></grey>
					  		<grey>端口:<input name="port" id="port"></grey> 
					  		<button id="setProxybtn">提交</button><br/>
					  	</p>
					  
						   
					  </div><!-- Tab Profile -->
					  
	    			  <!-- ===== Third Tab ===== -->
					  <div class="tab-pane" id="portfolio">
						   <form id="form2">
					 
					  	<h3>获取多个页面中的图片,每个页面url用换行符分割</h3>
					  	<!-- <h5>Web Designer</h5> -->
					  	<hr>
					  	<p>
					  		多页面url:<textarea name="url1"  rows="3" cols="80" ></textarea><br>
					  		<div>
					  			<span>
					  			元素选择器:<input name="select"  >
						  		</span> 
						  		<span>
						  			元素属性:<input name="attr">
						  		</span>  
						  		<button id="btn2">提交</button>
						  		<span  id="app">
						  			<a  href="/downloadZip"  v-bind:class="{'hidden': downloadbtn}" id="downloadZIPbtn">下载</a> <!--   v-bind:class="{'hidden': downloadbtn}"-->
						  		</span>
					  		</div>  
					    </p> 
					  	<textarea id="viewURL2" rows="7" cols="80" readonly > </textarea>
					  <!-- 	<p class="pull-right red"><i class="icon-heart"></i></p> -->
					  </form>
					  </div><!-- /Tab Portfolio -->
					  
	    			  <!-- ===== Fourth Tab ===== -->
					  <div class="tab-pane" id="contact">
						  <h4>根据具体图片url下载</h4>
						  <hr>
						  <div class="row">
						   		<div class="col-xs-6">
							  		<textarea name="imgUrls" id="imgUrls" rows="12" cols="80" ></textarea><br>
							  		<button  id="imgDownloadBtn" style="margin-top: 10px;">爬取</button>
							   </div><!-- col-xs-6 -->
							  
						  </div><!-- row -->
						  
						 
					  </div><!-- Tab Contact -->
					  
					</div><!-- Tab Content -->
    			</div><!-- col-md-8 -->
    		</div><!-- row w -->
    	</div><!-- col-lg-6 -->
    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script> 
    <script src="assets/js/vue.min.js"></script>  
   <!-- <script src="https://cdn.bootcss.com/vue/2.2.2/vue.min.js"></script> -->
​
<script>
//@ sourceURL=jsname.js
  
window.onbeforeunload= function(){
				return "重新加载?";
			}   

/* $(window).load(function(){
			window.onbeforeunload= function(){
				return "重新加载?";
			} 
		}) */
		
	$('#myTab a').click(function (e) {
	  e.preventDefault()
	  $(this).tab('show')
	})	
	
	$("#setProxybtn").click(function(){
		$.get("/setProxy/"+$("#host").val()+"/"+$("#port").val(),function(date){
			alert(date)
		})
		
	})
	
	$("#btn1").click(function(){
		var btn =$(this)
		var btntext = btn.text();
		btn.attr("disabled",true);
		btn.text("下载中...")
		
		$.post("/url",$("#form1").serialize(),function(data){
			var html ="";
			$.each(data,function(i,val){
				 html+=val+"\n";
			})
			$("#viewURL").val(html);
			
			//轮询是否下载完成, 完成下载,获取zip包
			var done = setInterval(function(){
				$.get("/downloadFinish",function(rs){
					//alert("done"+index++);
					if(rs == "done"){
						clearInterval(done); 
					//	$("#downloadZIPbtn").click(); //jQuery居然不能触发a 的click事件,用下面的原生写法
						document.getElementById("downloadZIPbtn").click();
						
						btn.removeAttr("disabled");
						btn.text(btntext);
						//alert("ok");
					}else{
						
					}
				})
			},2000)
			
			
		})
		return false;
	})
	
	$("#btn2").click(function(){
		var btn =$(this)
		var btntext = btn.text();
		btn.attr("disabled",true);
		btn.text("下载中...")
		$.post("/urls",$("#form2").serialize(),function(data){
			  
			var html ="";
			$.each(data,function(i,val){
				 html+=val+"\n";
			})
			$("#viewURL2").val(html);
			//轮询是否下载完成, 完成下载,获取zip包
			var done = setInterval(function(){
				$.get("/downloadFinish",function(rs){
					//alert("done"+index++);
					if(rs == "done"){
						clearInterval(done); 
					//	$("#downloadZIPbtn").click(); //jQuery居然不能触发a 的click事件,用下面的原生写法
						document.getElementById("downloadZIPbtn").click(); 
						btn.removeAttr("disabled");
						btn.text(btntext);
						//alert("ok");
					}else{
						
					}
				})
			},2000)
		})
		return false;
	})
	//后台下载图片
	$("#imgDownloadBtn").click(function(){ 
		var btn =$(this)
		btn.attr("disabled",true);
		btn.text("爬取ing")
		var index = 0;
		$.post("/downloadImage",{imgUrls:$("#imgUrls").val()},function(data){
			alert(data) 
		})
		var done = setInterval(function(){
				$.get("/downloadFinish",function(rs){
					//alert("done"+index++);
					if(rs == "done"){
						clearInterval(done);
						document.getElementById("downloadZIPbtn").click(); 
						btn.text("爬取");
						btn.removeAttr("disabled");
						
					}else{
						
					}
				})
			},2000)
		
	})
	
	//根据textarea中的url, 点击按钮直接下载 
	$("#crawlbtn1").click(function(){
		cacheImgDownload();
		return false;
	})
	$("#crawlbtn2").click(function(){
		cacheImgDownload();
		return false;
	})
	
	function cacheImgDownload(){
		$.get("/cacheDownload",function(data){
			alert(data)
		})
    }
    
	$(document).ajaxError(function(event,request, settings){
		alert("服务器出错了~");
		setTimeout(function(){location.reload();},1000)
	}); 
    
  /*   //zip
    $("#downloadZIPbtn1").click(function(){
    	finishZipDownload();
		return false;
	})

	function finishZipDownload(){
		$.get("/downloadZip",function(data){
			alert(1)
		})
    } */
     new Vue({
    	  el: '#app',
    	  data: {
    	 	
    	    downloadbtn :true
    	  }
    	})  
</script>    
    
  </body>
</html>
